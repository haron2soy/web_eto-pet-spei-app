{% load static %}
{% load dict_extras %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Climate Data Processing Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static  'css/base.css' %}">
</head>
<body>
<div class="container">

    <h1>Climate Data Processing Portal</h1>
    <p>
        Upload station-based climate CSV or Excel files.
        Data will be validated, combined, and previewed before computing
        ETo, PET, and SPEI.
    </p>
    <div class="layout">
    
    <form action="{% url 'upload' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="upload-box">
            <input type="file" name="files" multiple accept=".csv,.xlsx,.xls" required>
            <br>
            <button type="submit">Upload Climate Files</button>
        </div>
    </form>

    <div class="messages">
        {% for message in messages %}
            <div class="{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% if undetected_columns %}
        <h4>Undetected Columns (not used in computation)</h4>
        <ul>
            {% for col in undetected_columns %}
                <li>{{ col }}</li>
            {% endfor %}
        </ul>
    {% endif %}

{% if preview_rows %}
<h3>Combined Data Preview (first 100 rows)</h3>
<table>
    <thead>
        <tr>
            {% for col in preview_cols %}
            <th>{{ col }}</th> 
            {% endfor %} 
        </tr> 
    </thead> 
    <tbody> 
        {% for row in preview_rows %} 
        <tr> 
            {% for col in preview_cols %} 
            <td>{{ row|get_item:col }}</td> 
            {% endfor %} 
        </tr> 
        {% endfor %} 
    </tbody> 
</table> 
<div class="next-step"> 
    <button disabled>Compute ETo / PET / SPEI (Next)</button> 
</div> 

        <!-- RIGHT: Floating Station ID Form -->
        {% if missing_stationids %}
            <div class="missing-stationids-panel">
                <h3>Missing Station IDs</h3>
                <p>Please provide Station IDs to continue.</p>

                <form method="post" action="{% url 'save_station_ids' %}">
                    {% csrf_token %}

                    {% for station in missing_stationids %}
                        <div class="field">
                            <label>{{ station }}</label>
                            <input type="hidden"
                                name="stationname_{{ forloop.counter }}"
                                value="{{ station }}">
                            <input type="text"
                                name="stationid_{{ forloop.counter }}"
                                required>
                        </div>
                    {% endfor %}

                    <button type="submit" style="width:100%">
                        Save Station IDs
                    </button>
                </form>
            </div>
        {% endif %}

    </div>
{% endif %}

    <!-- {% if missing_stationids %}
<div class="sidebar">
    <h3>Missing Station IDs</h3>
    <p>Please provide Station IDs to proceed.</p>

    <form method="post" action="{% url 'save_station_ids' %}">
        {% csrf_token %}

        {% for station in missing_stationids %}
            <div style="margin-bottom: 12px;">
                <label><strong>{{ station }}</strong></label>
                <input type="hidden"
                       name="stationname_{{ forloop.counter }}"
                       value="{{ station }}">

                <input type="text"
                       name="stationid_{{ forloop.counter }}"
                       placeholder="Enter Station ID"
                       required
                       style="width:100%; padding:8px; margin-top:4px;">
            </div>
        {% endfor %}

        <button type="submit" style="width:100%;">
            Save Station IDs
        </button>
    </form>
</div>
{% endif %}-->

          </div>
        </div>
    </body>
</html>
